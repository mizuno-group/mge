# 2TB以上のHDD増設時の対応 (ubuntu20.04)
***
# 概要
Ubuntuマシンに8TBのHDDを増設した際の備忘用 (2021/11/3)  
2TBに境があり, 2TB以上の場合はディスクラベルをGPT形式にする必要があるため厄介  
ubuntu20.04  

# 参考
少し古いが[ここ](https://www.nemotos.net/?p=1394)がわかりやすかった  
/etc/fstabについては[ここら辺](https://qiita.com/kihoair/items/03635447591358210772)  

# 流れ
1. 増設したデバイスの同定 (fdisk)  
2. ディスクラベルの作成 (parted)  
3. パーティションの作成 (parted)  
4. ファイルシステムの作成 (mkfs)  
5. マウントポイントの作成  
6. 自動マウントの設定 (/etc/fstab)  

***
# 1. 増設したデバイスの同定
fdiskを使って接続されているデバイスを表示, ディスク容量辺りを見て論理名を見つける  
```$ sudo fdisk -l```  
```$ /dev/sda```みたいな感じ。今回はこれだとする  

***
# 2 & 3. ディスクラベル&パーティションの作成
partedを使ってディスクラベルとパーティションを作成する  

## (1) partedに入る
```$ sudo parted```  
- ↑により(parted)とプロンプトが変わる  

## (2) 対象の指定
```$ select /dev/sda```  
- 1.で見つけた増設したHDDの論理名を指定する  

## (3) ラベルの作成
```$ mklabel gpt```  

## (4) パーティションの作成
    
    unit TB
    mkpart primary 0.00TB 8.00TB
    
- 8TBのHDDだとする  
- 最初に単位を指定し, その後パーティションを作成する  

## (5) 確認
```$ print```  
- ディスクに論理名とサイズ, パーティションテーブルにgptと表示され, その下の一覧に指定したサイズのパーティションがあればOK  

***
# 4. ファイルシステムの作成
```$ sudo mkfs.ext4 /dev/sda```  
- 以降はいつもと同じ  
- ext4が基本という理解でOK  

***
# 5. マウントポイントの作成
```$ mkdir /mnt/{つけたい名前}```  
- /mnt下にディレクトリを作るだけ  
- わかりやすく短ければなんでも, data1, data2とか  
- 今回はdata1とする  

***
# 6. 自動マウントの設定
そのままだと都度マウントする必要があるため, 自動でマウントできるようにしておく  

## (1) UUIDの取得
```$ ls -l /dev/disk/by-uuid```  
- デバイスのUUID一覧が表示される  
- 英数字列 -> デバイス名というような形式になっており, 英数字列がUUID  

## (2) /etc/fstabを開く
```$ sudo gedit /etc/fstab```  
- gnomeのGUI editorが出てくるのでGUIで書き込む  
- vimとかのがやりやすいかも？  

## (3) /etc/fstabへの記載
```UUID=xxxxxxxx / ext4 defaults 0 0```のような箇所が先にあると思うので, その下に記載していく  
新たに増設したものをマウントする場合には以下のように書けばいい  
```UUID={調べたUUID}    /mnt/data1  ext4    defaults    0   0```  
- 間はtabかスペースらしいがとりあえずtabにしている  
- 起動ディスクの場合は最後の0を1にするっぽい, 起動時のチェックフラッグ  

## (4) 設定の保存
GUIなので普通に保存できる  
ただし変なWarningが出た, 無視して良いらしいが  
この辺りを考えるとvimやらCUIで記載した方が無難かも  
すぐにマウントしたかったら```$ sudo mount -a```でdefaults設定されているものがマウントできるっぽい  