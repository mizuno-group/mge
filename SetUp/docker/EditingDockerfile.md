# Dockerfileの編集

Dockerfileはdocker image作りのために少し書き方が変わったshファイルだと思うとわかりやすい。

基本形式は、

```
[コマンド] [引数]
```

をひたすら書いていくだけ

## コマンド集

### RUN

最も多く使うコマンド。ビルド時に引数部分を実行する。

```
RUN apt update
```

これは下記を実行するのと同等。

```
$ apt update
```

ビルド時のRUNに関して注意点として、yes/noのような実行中に入力が問われるようなコマンドは避けないとエラーになってしまう。なので、```apt install git```も```apt install -y git```と、yes/noを無視できるコマンドで書いたほうが良い。

### FROM

docker hubにアップロードされていたり、ローカルにある完成済のイメージを持ってくる。ビルド時間の短縮や可読性向上につながる。

### USER

ユーザーの切り替え。rootユーザーでの操作だと稀に不都合が生じることがある（日本語入力がどういうわけかできないなどが最たる例）ので、非rootユーザーに切り替えて設定を行うなどのときに使う。

### ARG

変数の宣言。```ARG VAR=1000```などのように書けば```$VAR```でその変数をDockerfile内で参照できるようになる。可読性や保守性を上げる。

### ENV

docker image内の環境変数を設定する。非常によく使われる。

```
ENV PATH /hogehoge/bin:$PATH
```

### ADD

docker image内にファイルを追加する。設定ファイルなどを追加するときに多用。

## ubuntu-desktop-mozcについて

このdocker imageは```dorowu/ubuntu-desktop-lxde-vnc```を日本語で運用できるように拡張したものだが、そのため少し特殊な書き方でDockerfileを書いている。まず、どういうわけか、rootユーザーでは日本語入力を導入することができない（他のubuntu系のdocker imageを見てもrootユーザーで日本語入力ができているものは見当たらなかった）ようなので、適当な名前のユーザー(```docker```)を追加して、そのユーザーで環境を構築している。このとき、非rootユーザーなのでsudoが必要な場面がいくつかあるが、そこでパスワードチェックを無効化するために```sudoers```というファイルを導入している。また、もともと```dorowu/ubuntu-desktop-lxde-vnc```は```startup.sh```というファイルをdocker image内に作ってそれを起動時に実行することでGUIを構築しているが、そこでデフォルトユーザーがrootにならないように改変している。また、最後に```USER root```でrootユーザーに戻しているのは、```startup.sh```の実行自体はrootユーザーで行わなければならないためである。